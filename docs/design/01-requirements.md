# 요구사항

## 1. 상품 목록

* GET ````/api/vi/products````

### 요구사항
* 사용자는 상품의 목록을 페이지네이션으로 확인할 수 있다.
* 특정 브랜드의 상품만 필터링 할 수 있어야 한다. 
* 조회 조건이 없을 경우 전체 상품 목록이 조회된다. 
* 검색 결과가 없을 경우 빈 목록이 조회된다.

## 2. 상품 상세
* GET ```/api/vi/products/{id}```

### 요구사항
* 사용자는 상품의 상세 내용을 확인할 수 있다.
* 없는 상품을 상세 조회시 에러를 발생한다. (404 NOT FOUND)

## 3. 브랜드 조회
* GET ```/api/vi/brand/{brandId}```

### 요구사항
* 사용자는 브랜드를 상세 조회할 수 있다.
* 없는 브랜드 조회시 에러를 발생한다.(404 NOT FOUND)

## 4. 상품 좋아요 등록
* POST ```/api/vi/products/{id}/likes``` 
### 요구사항
* 사용자는 로그인한 상태에서만 상품에 좋아요를 할 수 있다.
* 이미 좋아요된 상품에 좋아요 재등록의 경우 해당 요청사항도 성공 메세지를 보내되 실제 처리는 하지 않는다.
* 로그인하지 않은 사용자/존재하지 않는 사용자가 좋아요 등록 시도시 오류를 반환한다. (401 UNAUTHORIZED)
* 존재하지 않는 상품의 좋아요를 등록시 오류를 반환한다. (404 NOT FOUND)

## 5. 상품 좋아요 취소
* DELETE ```/api/vi/products/{id}/likes```
### 요구사항
* 사용자는 로그인한 상태에서만 상품에 취소를 할 수 있다.
* 좋아요 등록이 안된 상품을 취소하려 할 경우 오류를 반환한다. (404 NOT FOUND)
* 로그인하지 않은 사용자/존재하지 않는 사용자가 좋아요 취소 시도시 오류를 반환한다. (401 UNAUTHORIZED)
* 존재하지 않는 상품의 좋아요를 취소시 오류를 반환한다. (404 NOT FOUND)

## 6. 주문 생성 및 결제 흐름
* POST ```/api/vi/orders```
### 요구 사항
* 로그인한 사용자만 주문 생성을 할 수 있다. 
* 로그인하지 않은 사용자/존재하지 않는 사용자가 주문 생성 시도시 오류를 반환한다. (401 UNAUTHORIZED)
* 존재하지 않는 상품들이 포함된 주문 생성시 상품이 존재하는 상품만 주문 생성한다.
* 전체 상품이 유효하지 않으면 오류를 반환한다. (400 Bad Request 유효한 상품 없음)
* 사전 검증으로 유효한 상품에 대해 재고 수량이 충분한지 확인한다. 
* 모든 상품이 품절일 경우, 오류를 반환하며 주문 진행을 중단한다. (400 Bad Request 전부 품절)
* 일부만 품절일 경우, 유효한 상품만 주문에 포함한다.
* 일부 품절된 상품은 주문 응답 중 error데이터에 포함시켜 어떤 상품이 주문이 안되었는지 응답값으로 구붆해 넣는다.
* 주문 상품에 대해 PENDING 상태로 주문을 저장한다.
* 주문 ID를 생성하고 이후 결제 단계로 진행한다.
* 사용자가 주문시 포인트를 사용할 경우, 포인트 서비스에서 차감을 요청한다. 
* 포인트가 부족하거나 포인트 차감이 실패할 경우 주문은 롤백된다. (400 Bad Request 포인트 차감 실패/부족)
* 포인트 제외한 금액은 외부 결제 시스템에 요청된다. 
* 외부 결제는 최대 3회까지 재시도 할 수 있다. 
* 3회 모두 실패시 주문, 포인트 롤백한다. ( 500 Internal Server Error 결제 실패)
* 결제 성공하면 해당 상품에 대해 재고를 실제로 차감한다. 
* 재고 차감이 실패할 경우 주문, 결제, 포인트를 롤백한다.
* 결제 및 재고 차감이 모두 성공하면 주문 상태를 결제완료 로 변경한다.

